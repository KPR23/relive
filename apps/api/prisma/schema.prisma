generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id       String  @id @default(uuid())
  email    String  @unique
  password String
  name     String?

  folders Folder[]
  photos  Photo[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Folder {
  id          String  @id @default(uuid())
  name        String
  description String?

  ownerId String
  owner   User   @relation(fields: [ownerId], references: [id])

  parentId String?
  parent   Folder?  @relation("FolderHierarchy", fields: [parentId], references: [id])
  children Folder[] @relation("FolderHierarchy")
  isRoot   Boolean  @default(false)

  photos Photo[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([ownerId])
}

model Photo {
  id String @id @default(uuid())

  ownerId String
  owner   User   @relation(fields: [ownerId], references: [id])

  folderId String
  folder   Folder @relation(fields: [folderId], references: [id])

  filePath  String // np. /storage/2024/01/photo.jpg
  thumbPath String // np. /storage/2024/01/photo_thumb.webp

  originalName String
  mimeType     String
  size         Int

  takenAt DateTime?
  width   Int?
  height  Int?

  exif Json?

  createdAt DateTime @default(now())
}
